<!DOCTYPE html>
<html>
	<head>
		<script src="https://code.jquery.com/jquery-3.2.1.min.js"  
		integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" 
		crossorigin="anonymous"></script>
		<link rel="stylesheet" href="	https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css"/>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
	</head>
	<body class="brown lighten-1">
		<main>
			<div class="container">
				<div class="row">
					<a class="btn col s12 modal-trigger" href="#htp">How to play</a>
				</div>
				<div class="row">
					<a class="btn col s12 modal-trigger" href="#options">Options</a>
				</div>
				<div class="row">
					<button id="play" class="btn col s12 m5">Play</button>
					<button id="reset" class="btn col s12 m5 push-m2">Reset</button>
				</div>
				<div id="game"></div>
				<div class="row">
					<p><h5 id="s1">Player 1 Score:</h5> </p>
					<p><h5 id="s2">Player 2 Score:</h5> </p>
				</div>
			</div>
			<div id="htp" class="modal">
				<div class="modal-content">
					<h4>How to play</h4>
					<p>
						<strong>The objective of the game is to have the fewest points around the remaining square, 'the black hole'</strong>
						<ol>
						<li>Select board size using the options menu.</li>
						<li>Click Play.</li>
						<li>Alternating turns, click in each box to place your token there.</li>
						<li>When there is 1 spot left in the table, the game is over.</li>
						<li>Scores are then shown beneath the playing grid.</li>
						</ol>
					</p>
				</div>
				<div class="modal-footer">
					<a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Close</a>
				</div>
			</div>
			<div id="options" class="modal">
				<div class="modal-content">
					<h4>Options</h4>
					<form action="javascript:void(0)">
					Size:<input type="number" min=3 max=9 step=2 name="size" id="size" value="5" />
					</form>
				</div>
				<div class="modal-footer">
					<a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Close</a>
				</div>
			</div>
		</div>
		</main>
		
	</body>
	<script>
		$(document).ready(function(){
			$(".modal").modal();
			$("#play").click(start);
			$("#reset").click(reset);
		});
	
		var p1Counter=1,p2Counter=1, p1Turn=true;
		var rowSize = 3, tc=0;
		var tcMax =0;
		var hole = -1;
		var visScore = false;
		
		function reset(){
			$("table").remove();
			p1Counter=1;
			p2Counter=1;
			p1Turn=true;
			rowSize = 3;
			tc=0;
			tcMax =0;
			hole = -1;
			visScore=false;
			
		}
		
		$("#size").on("change", function(){
			rowSize=document.getElementById("size").value;
			p1Counter=1,p2Counter=1, p1Turn=true;
		});
		
		function start() {
			document.getElementById("game").innerHTML=createBoard(rowSize);
		}
		
		function createBoard(x) {
			tcMax=x*x;
			var s = "<table id='board'>";
			var i=0;
			var j=0;
			while(i<x) {
				s+="<tr>";
				while(j<x) {
					if(j%2==1&&i%2==1)
						s+="<td id="+((i*x)+j)+" class='black' ></td>";	
					else if((j%2==1)||i%2==1)
						s+="<td id="+((i*x)+j)+" class='white' ></td>";
					else
						s+="<td id="+((i*x)+j)+" class='black' ></td>";	
					j++;
				}
				s+="</tr>";
				i++;
				j=0;
			}
			s+="</table>";
			return s;
		}
		
		$(document).click(function(event){
			var targ = $(event.target);
			applyCounter(targ);
		});
		
		function applyCounter(id) {
			if(id[0].tagName=='TD' && tc<=tcMax && !id[0].hasChildNodes()) {
				if(p1Turn) {
					id[0].innerHTML=p1Counter;
					id.addClass("red-text");
					p1Counter++;
					p1Turn=!p1Turn;
				}
				else {
					id[0].innerHTML=p2Counter;
					id.addClass("blue-text");
					p2Counter++;
					p1Turn=!p1Turn;
				}
				tc++;
			}
			calcScore();
		}
		
		function calcScore() {
			if(tc==(tcMax-1)) {
				p1Counter=p2Counter=0;
				var tdList=document.getElementsByTagName('td');
				var i = 0;
				while(i<tdList.length) {
					if(!tdList[i].hasChildNodes()) {
						hole=i;
						break;
					}
					i++;
				}
			}
			if(hole!==-1){
				var right = ((hole%rowSize)==(rowSize-1));
				var left = ((hole%rowSize)==0);
				var bottom =(parseInt(hole)+parseInt(rowSize))>=(rowSize*rowSize); 
				var top = (hole-rowSize)<=0;
				var tr = $('#'+(hole+1-rowSize)), tm = $('#'+(hole-rowSize)), tl = $('#'+(hole-1-rowSize)), ml = $('#'+(hole-1)),
				mr = $('#'+(hole+1)), br = $('#'+(parseInt(hole)+1+parseInt(rowSize))),	bm = $('#'+(parseInt(hole)+parseInt(rowSize))),
				bl = $('#'+(parseInt(hole)-1+parseInt(rowSize)));
				if(top&&right){
					addScore(ml);
					addScore(br);
					addScore(bm);
				}
				else if(top&&left){
					addScore(mr);
					addScore(br);
					addScore(bm);
				}
				else if(bottom&&right){
					addScore(tm);
					addScore(tl);
					addScore(ml);
				}
				else if(bottom&&left){
					addScore(tr);
					addScore(tm);
					addScore(mr);
				}
				else if(top){
					addScore(mr);
					addScore(ml);
					addScore(br);
					addScore(bm);
					addScore(bl);
				}
				else if(bottom){
					addScore(tr);
					addScore(tm);
					addScore(tl);
					addScore(mr);
					addScore(ml);
				}
				else if(left){
					addScore(tr);
					addScore(tm);
					addScore(mr);
					addScore(br);
					addScore(bm);
				}
				else if(right){
					addScore(tm);
					addScore(tl);
					addScore(ml);
					addScore(bm);
					addScore(bl);
				}
				else{
					addScore(tr);
					addScore(tm);
					addScore(tl);
					addScore(mr);
					addScore(ml);
					addScore(br);
					addScore(bm);
					addScore(bl);
				}
				displayScore();
			}
			
		}
		
		function addScore(element) {
			if(element.hasClass("red-text")) p1Counter+=parseInt(element.text());
			else if(element.hasClass("blue-text")) p2Counter+=parseInt(element.text());
		}
		
		function displayScore() {
			if(!visScore){
				visScore=!visScore;
				$("#s1").append(p1Counter+", ");
				$("#s2").append(p2Counter+", ");
				if(p1Counter>p2Counter)
					alert("Player 2 Wins");
				else if(p1Counter<p2Counter)
					alert("Player 1 Wins");
				else
					alert("Draw");

			}
		}
		
	</script>
<html>